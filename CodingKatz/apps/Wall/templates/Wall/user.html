<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{{ user.first_name }}'s Wall</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'Wall/css/style.css' %}">
  </head>
  <body>
    <a href="{% url 'User:profile' %}">Profile</a>
    <a href="{% url 'Wall:wall' %}">The Wall</a>
    <!-- user info then messages-->
    <h2>{{user.first_name}} {{user.last_name}}</h2>
    <table>
      <tbody>
        <tr>
          <td>Member Since: </td>
          <!-- time is showing 3 hours ahead but this fix does not work -->
          {% load tz %}
          {% localtime on %}
          <td>{{user.created_at}}</td>
          {% endlocaltime %}
        </tr>
    <!-- CONSIDER OTHER STATS TO ADD HERE -->
      </tbody>
    </table>
    <h2>Leave a message for {{user.first_name}}</h2>
    <div class="flash_messages">
      {% if messages %}
        {% for message in messages %}
          <p class="error">{{message}}</p>
        {% endfor %}
      {% endif %}
    </div>
    <form action="{% url 'Wall:message' %}" method="post">
      {% csrf_token %}
      <textarea name="message" rows="8" cols="80">Write your message here</textarea>
      <button type="submit" name="button">Post</button>
    </form>
    {% for message in all_messages %}
    <div class="label">
      <a href="{% url 'Wall:show_user' message.author.id %}" class='label_left'>{{message.author.first_name}} {{message.author.last_name}}</a>
      <p class="label_right">{{message.created_at|timesince}} ago</p>
    </div>
    <div class="message">
      <p>{{message.message}}</p>
      {% for comment in comments %}
      <div class="comments">
        {% if message.id == comment.message.id %}
        <div class="label">
          <a href="{% url 'Wall:show_user' comment.author.id %}">{{comment.author.first_name}} {{comment.author.last_name}}</a>
          <p class="label_right">{{comment.created_at|timesince}} ago</p>
        </div>
        <div class="comment">
          <p>{{comment.comment}}</p>
        </div>
        {% endif %}
      </div>
      {% endfor %}
      <div class="flash_messages">
        {% if messages %}
          {% for message in messages %}
            <p class="error">{{message}}</p>
          {% endfor %}
        {% endif %}
      </div>
      <form action="{% url 'Wall:comment' message_id=message.id %}" method="post">
        {% csrf_token %}
        <textarea name="comment" rows="4" cols="80">Write your comment here</textarea>
        <button type="submit" name="button">Post</button>
      </form>
    </div>
    {% endfor %}
  </body>
</html>
